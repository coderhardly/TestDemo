@model Model.Users
@{ Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>

    <script src="~/Scripts/jquery-1.7.min.js"></script>

    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />

    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/Scripts/MyAjaxForm.js"></script>
  
    <script src="~/Scripts/bootstrap.min.js"></script>


</head>
<body>
    @using (Ajax.BeginForm("User", new { }, new AjaxOptions() { OnSuccess = "afterEdit" }, new {@class= "form-horizontal", id = "editForm" }))
    {
            @*<table class="tc_table_cp" border="0" style="margin:0 auto">
                <tr>*@
                    <input type="file" name="MenuIcon" id="imgIcon" />
                    <input type="button" id="btnUpload" value="图片上传" />
                    <input type="hidden" id="hidImage" name="ImagePath" value="@Model.uphoto" />
                    <div id="menuIconShow">
                        <img src="@Model.uphoto" id="imgPath"style=" width:40px;height:40px" />
                    </div>
                @*</tr>
            </table>*@
            }
            <form class="form-horizontal" id="UpdateUser">
                <div class="container">
                    <div class="row" style="padding: 20px 0">
                        <h3>个人信息修改</h3>
                    </div>

                    <div class="row form-group">
                        <label class="control-label col-lg-1" for="name">昵称</label>
                        <div class="col-lg-5 col-md-6">
                            @*<input class="form-control" name="name" id="name" type="text">*@
                            @Html.TextBoxFor(m => m.uName, new {@class="form-control",id="uname" })
                        </div>
                    </div>
                    <div class="row form-group">
                        <label class="control-label col-lg-1">邮箱</label>

                        <div class="col-lg-5 col-md-6">
                            @*<textarea class="form-control" rows="5"></textarea>*@
                            @Html.TextAreaFor(m => m.umail,new {@class="form-control",rows="5" ,id="umail" });
                        </div>
                    </div>
                    <div class="row form-group">
                        <label class="control-label col-lg-1">手机号</label>
                        <div class="col-lg-5 col-md-6">
                            @Html.TextBoxFor(m => m.telphone, new { @class = "form-control", id = "utel" })
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-lg-5 col-md-2">
                         <input type="button" value="修改" id="modifyUser" />
                        </div>
                    </div>
                </div>
            </form>
        
   
</body>
  
</html>
<script type="text/javascript">

    $(function () {
        bindFileUpload();
        $("#modifyUser").click(function () {
            var name = $("#uname").val();
            var mail = $("#umail").val();
            var tel= $("#utel").val();
            alert(tel);
            $.ajax({
                type: 'post',
                url: '/User/UpdateUserInfo',
                data: { Name: name, Mail: mail, Tel: tel },
                
                        success: function (data) {
                           
                            if (data.flag==true) {
                                alert("修改个人信息成功")
                            } else {
                                alert("个人信息修改错误!");
                            }
                        }
            })

        });
    })

    
    //文件异步上传
    function bindFileUpload() {
        $("#btnUpload").click(function () {
            if ($("#imgIcon").val() == "") {
                alert( "请选择图片文件");
                return;
            }
            $("#editForm").ajaxSubmit({
                type: 'post',
                url: '/User/FileUpload',
                success: function (data) {
                    var serverData = data.split(':');
                    if (serverData[0] == "ok") {
                        $("#hidImage").attr("value", serverData[1]);//将服务端返回的图片路径赋给隐藏域
                        $("#menuIconShow").html("");//先清除以前的，然后再添加。
                        $("#menuIconShow").append("<img src='" + serverData[1] + "' width='40px' height='40px' />");
                        console.log("上传成功")
                    } else {
                        $.messager.alert("提示", "图片上传错误!");
                    }
                }
            });
          
        });
       
       
    }
    


</script>


